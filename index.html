<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tomar fotografías</title>
</head>
<body>
	<center><h1>Demo de la cámara de llamada HTML5</h1></center>
<video id="video" width="640" height="480" autoplay="autoplay"></video>
<canvas id="canvas" width="640" height="480"></canvas>
<!--Tocar botón-->
<div>
	<button id="opencapture" onclick="getMedia()">Abierto</button>
	<button onclick="stopStreamedVideo(video)">Cerrar la cámara</button>
    <button id="capture">Tomar fotografías</button>
</div>
<!--Describe la captura de pantalla del video.-->
<script>
    let video = document.getElementById("video");
    let canvas = document.getElementById("canvas");
    let context = canvas.getContext("2d");
    // El navegador antiguo puede no implementar medios medianos en absoluto, por lo que podemos establecer un objeto vacío primero
    if (navigator.mediaDevices === undefined) {
        navigator.mediaDevices = {};
    }

    // Algunos compatibles con el navegador soportan Mediadevices. No podemos configurar GetUsergemedia directamente
    // Porque esto puede anular las propiedades existentes. Aquí solo lo agregaremos cuando no hay propiedad de GetUsermedia.
    if (navigator.mediaDevices.getUserMedia === undefined) {
        navigator.mediaDevices.getUserMedia = function (constraints) {

            // primero, si tienes getUsermedia, consíguelo
            var getUserMedia = navigator.webkitGetUserMedia || navigator.mozGetUserMedia;

            // Algunos navegadores no lo implementan en absoluto, y luego devolviendo un error para prometer rechazar para mantener una interfaz unificada
            if (!getUserMedia) {
                return Promise.reject(new Error('getUserMedia is not implemented in this browser'));
            }

            / / De lo contrario, envuelva una promesa para el antiguo Navigator.getUsermedia Método
            return new Promise(function (resolve, reject) {
                getUserMedia.call(navigator, constraints, resolve, reject);
            });
        }
    }
	//MediaStream.getTracks()[1].stop();
    / / La cámara frontal se usa de forma predeterminada, use forzando la cámara trasera de la siguiente manera
    // let constraints = {video: { facingMode: { exact: "environment" } }};
    function getMedia(){
    let constraints = {video: true};
    navigator.mediaDevices.getUserMedia(constraints)
        .then(function (stream) {
            // El navegador viejo puede no tener srcobject
            if ("srcObject" in video) {
                video.srcObject = stream;
            } else {
                / / Evitar que lo use en un nuevo navegador, ya no debe ser compatible con él.
                video.src = window.URL.createObjectURL(stream);
            }
            video.onloadedmetadata = function (e) {
                video.play();
            };
        })
        .catch(function (err) {
            console.log(err.name + ": " + err.message);
        });
        }
    // Cerrar la cámara VidoeeeM para el ID de video
	function stopStreamedVideo(videoElem) {
		  const stream = videoElem.srcObject;
		  const tracks = stream.getTracks();

		  tracks.forEach(function(track) {
		    track.stop();
		  });

		  videoElem.srcObject = null;
		}
    / / Registre el botón TAP para hacer clic en evento
    document.getElementById("capture").addEventListener("click", function () {
        // Hacer un dibujo
        context.drawImage(video, 0, 0, 640, 480);
    });
</script>
</body>
</html>
